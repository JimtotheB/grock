/*
# # Grock Solarized Side Menu
#
# @copyright 2014 Pascal Hertleif
# @license MIT
*/
(function(){var e,n,t,a,r,l,i,o,c;e=Zepto||jQuery,i=function(e){var n,t,a,r,l,i,o,c,s,d,u,h,f;for(o={},d=0,h=e.length;h>d;d++)for(a=e[d],l=a.path.split("/"),r=l.length-1,n=o,t=u=0,f=l.length;f>u;t=++u){if(i=l[t],t===r-1&&a.originalName.match(/index\.(js|coffee)/)){n[i].path=a.path,n[i].originalName=a.originalName,n[i].originalPath=a.originalPath,n[i].name=a.name,n[i].title=i,n[i].type="file",(c=n[i]).children||(c.children={});break}t===r?(n[i]=a,n[i].type="file"):(n[i]||(n[i]={name:i,type:"folder"}),n=(s=n[i]).children||(s.children={}))}return o},c=function(e){var n,t,a,r,l,i,o;for(t=[],a={},i=0,o=e.length;o>i;i++)n=e[i],r=n.level||(n.level=1),a[r-1]?((l=a[r-1]).children||(l.children=[]),a[r-1].children.push(n)):t.push(n),a[r]=n;return t},n=function(t,a,r){var l;return l=e(a),null==t?(console.warn("No File Tree!"),l):(e.each(t,function(t,a){var i,o,c,s,d;o=e('<li class="'+a.type+'"/>'),"file"===a.type?(c=a===r.currentFile,o.append('<a class="file'+(c?" selected":"")+'" href="'+r.relativeRoot+a.path+'" title="'+(a.originalName||a.name)+'">'+(a.title||a.originalName||a.name)+"</a>")):o.append('<span class="folder">'+a.name+"</span>"),null!=a.children&&(i=e('<ol class="children"/>'),o.append(n(a.children,i,r))),s=(null!=(d=a.originalName)?d.match(/^readme\.(md|txt|rst)/i):void 0)?"prepend":"append",l[s](o)}),l)},t=function(n,a,r){return a=e(a),(null!=n?n.length:void 0)?(e.each(n,function(n,l){var i,o,c;o=e('<li class="'+l.type+'"/>'),o.append('<a class="label" href="#'+l.slug+'"><span class="text">'+l.title+"</span></a>"),(null!=(c=l.children)?c.length:void 0)>0&&(i=e('<ol class="children"/>'),o.append(t(l.children,i,r))),a.append(o)}),a):a},l=function(){var n;return n=e('<aside id="side-menu">\n  <nav id="headlines">\n    <details>\n      <summary>This File</summary>\n      <ul class="tools">\n        <li class="search">\n          <input id="search-headlines" type="search" autocomplete="off" placeholder="Search"/>\n        </li>\n      </ul>\n      <ol class="tree" id="headline-tree"></ol>\n    </details>\n  </nav>\n  <nav id="files">\n    <details open>\n      <summary>Files</summary>\n      <ul class="tools">\n        <li class="search">\n          <input id="search-files" type="search" autocomplete="off" placeholder="Search"/>\n        </li>\n      </ul>\n      <ol class="tree" id="file-tree"></ol>\n    </details>\n  </nav>\n</aside>')},r=function(n,t){var a;return a=e('<button type="button" class="toggle-menu">\n  Menu\n</button>'),a.on("click",function(e){return e.preventDefault(),t.toggleClass("open")}),n.prepend(a),n},o=function(n,t){var a,r,l;return r=function(){return function(e,n){var t;return null==n&&(n=100),t&&window.clearTimeout(t),t=window.setTimeout(function(){return t=null,"function"==typeof e?e():void 0},n)}}(),a=function(n,t){return t=t.trim().toLowerCase(),n.find(".matched").removeClass("matched"),""===t?(console.log("stop searching"),void n.removeClass("searching")):(n.addClass("searching"),n.find("a").each(function(n,a){var r;r=e(a),(r.text().toLowerCase().indexOf(t)>-1||r.attr("href").toLowerCase().indexOf(t)>-1)&&(r.addClass("matched"),r.parents("li").children(".label").addClass("matched"))}))},l=null,t.on("keyup search",function(e){var t;return t=e.target.value,t===l||2>t&&""!==t?void 0:(l=t,r(function(){return a(n,l)}))}),t.on("keydown",function(e){return 27===e.keyCode?""===t.val().trim()?t.blur():t.val(""):void 0})},a=function(a,r){var s,d,u,h,f,p;if(!a)return e("");for(s=l(r),f=0,p=a.length;p>f;f++)if(d=a[f],d.originalPath===r.documentPath){r.currentFile=d;break}return u=i(a),n(u,s.find("#file-tree"),r),o(s.find("#file-tree"),s.find("#search-files")),r.currentFile&&(h=c(r.currentFile.toc||[]),t(h,s.find("#headline-tree"),r),o(s.find("#headline-tree"),s.find("#search-headlines"))),s},e(function(){var n,t;return t={relativeRoot:e('meta[name="groc-relative-root"]').attr("content"),githubURL:e('meta[name="groc-github-url"]').attr("content"),documentPath:e('meta[name="groc-document-path"]').attr("content"),projectPath:e('meta[name="groc-project-path"]').attr("content")},n=a(window.files,t),n.prependTo(e("body")),r(e("#meta"),n),window.listToTree=i,window.tocToTree=c})}).call(this);
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>compileAll.coffee</title>

  <link rel="stylesheet" href="../assets/style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
  <meta name="groc-relative-root" content="../"/>
  <meta name="groc-document-path" content="styles/compileAll.coffee"/>
  
  <meta name="groc-repository-url" content="https://github.com/killercup/grock"/>
  
</head>
<body>
  <div id="file-area">
    <div id="meta">
      <code class="file-path">
      
        <a href="https://github.com/killercup/grock/blob/master/styles/compileAll.coffee">styles/compileAll.coffee</a>
      
      </code>
    </div>
    <div id="document">
    
      <div class="segment">
      
      
        <div class="code">
          <div class="wrapper">path = <span class="hljs-built_in">require</span> <span class="hljs-string">'path'</span>
vfs = <span class="hljs-built_in">require</span> <span class="hljs-string">'vinyl-fs'</span>
map = <span class="hljs-built_in">require</span> <span class="hljs-string">'map-stream'</span>

prettyTime = <span class="hljs-built_in">require</span> <span class="hljs-string">'pretty-hrtime'</span>
colors = <span class="hljs-built_in">require</span> <span class="hljs-string">'chalk'</span>
log = <span class="hljs-built_in">require</span> <span class="hljs-string">'../lib/utils/log'</span>

<span class="hljs-function"><span class="hljs-title">duration</span> = <span class="hljs-params">(start)</span> -&gt;</span>
  colors.magenta(prettyTime(process.hrtime(start)))

<span class="hljs-function"><span class="hljs-title">indexToStyleName</span> = <span class="hljs-params">(filePath)</span> -&gt;</span>
  path.dirname(filePath).split(<span class="hljs-string">'/'</span>).pop()

<span class="hljs-function"><span class="hljs-title">callCompile</span> = <span class="hljs-params">(file, cb)</span> -&gt;</span>
  style = <span class="hljs-built_in">require</span> <span class="hljs-string">"./<span class="hljs-subst">#{file.relative}</span>"</span>

  style.compile()
  .<span class="hljs-keyword">then</span><span class="hljs-function"> -&gt;</span> cb(<span class="hljs-literal">null</span>, file)
  .<span class="hljs-keyword">then</span> <span class="hljs-literal">null</span>, cb

<span class="hljs-function"><span class="hljs-title">compileAll</span> = -&gt;</span>
  vfs.src(<span class="hljs-string">"<span class="hljs-subst">#{__dirname}</span>/*/index.{js,coffee}"</span>)
  .pipe<span class="hljs-function"><span class="hljs-params">(map (file, cb) -&gt;
    log <span class="hljs-string">'compiling'</span>, indexToStyleName(file.relative)
    file.timingStart = process.hrtime()
    cb(<span class="hljs-literal">null</span>, file)
  )</span>
  .<span class="hljs-title">pipe</span><span class="hljs-params">(map callCompile)</span>
  .<span class="hljs-title">pipe</span><span class="hljs-params">(map (file, cb) -&gt;
    log <span class="hljs-string">"compiled"</span>, indexToStyleName(file.relative), duration(file.timingStart)
    cb(<span class="hljs-literal">null</span>, file)
  )</span>

<span class="hljs-title">compileAll</span><span class="hljs-params">()</span></span></div>
        </div>
      
      </div>
    
    </div>
  </div>

  <script src="../toc.js"></script>
  <script src="../assets/libs.js"></script>
  <script src="../assets/behavior.js"></script>
</body>
</html>
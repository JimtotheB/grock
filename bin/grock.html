<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>grock CLI - grock</title>

  <link rel="stylesheet" href="../assets/style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
  <meta name="groc-relative-root" content="../"/>
  <meta name="groc-document-path" content="bin/grock"/>
  
  <meta name="groc-repository-url" content="https://github.com/killercup/grock"/>
  
</head>
<body>
  <div id="file-area">
    <div id="meta">
      <code class="file-path">
      
        <a href="https://github.com/killercup/grock/blob/master/bin/grock">bin/grock</a>
      
      </code>
    </div>
    <div id="document">
    
      <div class="segment">
      
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h1 id="grock-cli"><a href="#grock-cli" class="anchor"></a>grock CLI</h1></div>
        </div>
      
      
        <div class="code"><div class="wrapper"><span class="hljs-pi">'use strict'</span>;

<span class="hljs-keyword">var</span> START = process.hrtime();

<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span>  _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lodash'</span>);
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h2 id="load-project-config"><a href="#load-project-config" class="anchor"></a>Load Project Config</h2></div>
        </div>
      
      
        <div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> projectConfig;
<span class="hljs-keyword">var</span> projectConfigPath = path.resolve(<span class="hljs-string">'.groc.json'</span>);
<span class="hljs-keyword">try</span> {
  projectConfig = <span class="hljs-built_in">JSON</span>.parse(fs.readFileSync(projectConfigPath));
} <span class="hljs-keyword">catch</span> (e) {
  projectConfig = {};
}
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h2 id="cli-arguments"><a href="#cli-arguments" class="anchor"></a>CLI Arguments</h2></div>
        </div>
      
      
        <div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> optimist = require(<span class="hljs-string">'optimist'</span>)
  .usage(
    <span class="hljs-string">"Usage: grock [options]\n\n"</span>+
    <span class="hljs-string">"You can also use a configuration file named .groc.json to specify "</span>+
    <span class="hljs-string">"these options."</span>
  )

  .boolean(<span class="hljs-string">'help'</span>)
  .describe(<span class="hljs-string">'help'</span>, <span class="hljs-string">'Show this message'</span>)
  .alias(<span class="hljs-string">'h'</span>, <span class="hljs-string">'help'</span>)
  .alias(<span class="hljs-string">'?'</span>, <span class="hljs-string">'help'</span>)

  .boolean(<span class="hljs-string">'version'</span>)
  .describe(<span class="hljs-string">'version'</span>, <span class="hljs-string">'Show grock version'</span>)

  .<span class="hljs-keyword">string</span>(<span class="hljs-string">'glob'</span>)
  .<span class="hljs-keyword">default</span>(<span class="hljs-string">'glob'</span>, projectConfig.glob || <span class="hljs-string">'lib/*.coffee'</span>)
  .describe(<span class="hljs-string">'glob'</span>, <span class="hljs-string">'Set glob to match source files'</span>)

  .<span class="hljs-keyword">string</span>(<span class="hljs-string">'out'</span>)
  .<span class="hljs-keyword">default</span>(<span class="hljs-string">'out'</span>, projectConfig.<span class="hljs-keyword">out</span> || <span class="hljs-string">'docs/'</span>)
  .describe(<span class="hljs-string">'out'</span>, <span class="hljs-string">'Render documentation into here'</span>)

  .<span class="hljs-keyword">string</span>(<span class="hljs-string">'style'</span>)
  .<span class="hljs-keyword">default</span>(<span class="hljs-string">'style'</span>, projectConfig.style || <span class="hljs-string">'solarized'</span>)
  .describe(<span class="hljs-string">'style'</span>, <span class="hljs-string">'Set the output style/theme'</span>)

  .boolean(<span class="hljs-string">'verbose'</span>)
  .<span class="hljs-keyword">default</span>(<span class="hljs-string">'verbose'</span>, projectConfig.verbose || <span class="hljs-keyword">false</span>)
  .alias(<span class="hljs-string">'v'</span>, <span class="hljs-string">'verbose'</span>)
  .describe(<span class="hljs-string">'verbose'</span>, <span class="hljs-string">'Show more log output'</span>)

  .<span class="hljs-keyword">string</span>(<span class="hljs-string">'index'</span>)
  .<span class="hljs-keyword">default</span>(<span class="hljs-string">'index'</span>, projectConfig.index || <span class="hljs-string">'Readme.md'</span>)
  .describe(<span class="hljs-string">'index'</span>, <span class="hljs-string">'File to be used as index'</span>)
  .alias(<span class="hljs-string">'i'</span>, <span class="hljs-string">'index'</span>)

  .<span class="hljs-keyword">string</span>(<span class="hljs-string">'root'</span>)
  .<span class="hljs-keyword">default</span>(<span class="hljs-string">'root'</span>, projectConfig.root || <span class="hljs-string">'.'</span>)
  .describe(<span class="hljs-string">'root'</span>, <span class="hljs-string">"The project's root directory"</span>)

  .boolean(<span class="hljs-string">'github'</span>)
  .<span class="hljs-keyword">default</span>(<span class="hljs-string">'github'</span>, projectConfig.github || <span class="hljs-keyword">false</span>)
  .describe(<span class="hljs-string">'github'</span>, <span class="hljs-string">"Push generated docs to gh-pages branch"</span>)

  .<span class="hljs-keyword">string</span>(<span class="hljs-string">'git-remote'</span>)
  .describe(<span class="hljs-string">'git-remote'</span>, <span class="hljs-string">"Overwrite the remote for --github"</span>)
  ;
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h3 id="display-help"><a href="#display-help" class="anchor"></a>Display Help</h3></div>
        </div>
      
      
        <div class="code"><div class="wrapper">if (optimist<span class="hljs-preprocessor">.argv</span><span class="hljs-preprocessor">.help</span>) {
  optimist<span class="hljs-preprocessor">.showHelp</span>()<span class="hljs-comment">;</span>
  return process<span class="hljs-preprocessor">.exit</span>(<span class="hljs-number">2</span>)<span class="hljs-comment">;</span>
}
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h3 id="display-version"><a href="#display-version" class="anchor"></a>Display Version</h3></div>
        </div>
      
      
        <div class="code"><div class="wrapper">if (optimist<span class="hljs-preprocessor">.argv</span><span class="hljs-preprocessor">.version</span>) {
  var pkg = JSON<span class="hljs-preprocessor">.parse</span>(fs<span class="hljs-preprocessor">.readFileSync</span>(__dirname+<span class="hljs-string">"/../package.json"</span>))<span class="hljs-comment">;</span>
  console<span class="hljs-preprocessor">.log</span>(<span class="hljs-string">"Version"</span>, pkg<span class="hljs-preprocessor">.version</span>)<span class="hljs-comment">;</span>
  return process<span class="hljs-preprocessor">.exit</span>(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
}
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Overwrite defaults/project config with CLI arguments</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">var argv = _.defaults(optimist.argv, projectConfig);
argv.<span class="hljs-operator"><span class="hljs-keyword">start</span> = <span class="hljs-keyword">START</span>;</span>
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>Load Generator</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper"><span class="hljs-built_in">require</span>(<span class="hljs-string">'coffee-script/register'</span>);
<span class="hljs-keyword">var</span> generator = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/generator'</span>);

<span class="hljs-keyword">if</span> (argv.github) {</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h2 id="write-to-github-pages-branch"><a href="#write-to-github-pages-branch" class="anchor"></a>Write to Github Pages Branch</h2></div>
        </div>
      
      
        <div class="code"><div class="wrapper">  argv.out = path.resolve(path.join(<span class="hljs-string">'.git'</span>, <span class="hljs-string">'groc-tmp'</span>));

  <span class="hljs-keyword">return</span> generator(argv)
  .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> gitPublishScript = path.resolve(__dirname, <span class="hljs-string">'..'</span>, <span class="hljs-string">'scripts'</span>, <span class="hljs-string">'publish_git_pages.sh'</span>);
    <span class="hljs-keyword">var</span> opts = argv[<span class="hljs-string">'git-remote'</span>] ? [argv[<span class="hljs-string">'git-remote'</span>]] : void(<span class="hljs-number">0</span>);

    <span class="hljs-keyword">var</span> publishing = <span class="hljs-keyword">require</span>(<span class="hljs-string">'child_process'</span>).spawn(gitPublishScript, opts);

    publishing.stdout.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span> console.log(data.toString().trim()); });
    publishing.stderr.on(<span class="hljs-string">'data'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(data)</span> {</span> console.warn(data.toString().trim()); });
    publishing.on(<span class="hljs-string">'exit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(code)</span> {</span>
      <span class="hljs-keyword">if</span> (code) {
        console.log(<span class="hljs-string">"Publishing to Github Pages failed with code"</span>, code);
      }
      process.<span class="hljs-keyword">exit</span>(code);
    });
  }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    process.<span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);
  });
} <span class="hljs-keyword">else</span> {</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><h2 id="write-regularly"><a href="#write-regularly" class="anchor"></a>Write Regularly</h2></div>
        </div>
      
      
        <div class="code"><div class="wrapper">  return generator(argv)
  .<span class="hljs-keyword">then</span>(<span class="hljs-keyword">function</span> () {
    process.<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);
  }, <span class="hljs-keyword">function</span> (<span class="hljs-built_in">err</span>) {
    console.<span class="hljs-built_in">log</span>(<span class="hljs-string">"Failed to compile documentation."</span>);
    <span class="hljs-keyword">if</span> (argv.verbose) {
      console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">err</span>.stack || <span class="hljs-built_in">err</span>);
    } <span class="hljs-keyword">else</span> {
      console.<span class="hljs-built_in">log</span>(<span class="hljs-string">"Run with `--verbose` for more information."</span>);
    }
    process.<span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);
  })
  ;
}
</div></div>
      
      </div>
    
    </div>
  </div>

  <script src="../toc.js"></script>
  <script src="../assets/libs.js"></script>
  <script src="../assets/behavior.js"></script>
</body>
</html>